machine:
  node:
    version: 9.3.0
  environment:
    ETA_AUTH_PROVIDER: local
    ETA_DB_PROVIDER: postgres
    ETA_DB_HOST: localhost
    ETA_DB_PORT: 5432
    ETA_DB_USERNAME: ubuntu
    ETA_DB_DATABASE: circle_test
compile:
  override:
    - npm run eta -- generate indexes
    - npm run eta -- compile server
test:
  environment:
    MOCHA_FILE: $CIRCLE_TEST_REPORTS/junit/test-results.xml
  - npm run test
  post: NODE_ENV=test istanbul cover ./node_modules/mocha/bin/_mocha --report lcovonly -- -R spec && cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js && rm -rf ./coverage
