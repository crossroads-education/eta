machine:
  node:
    version: 9.3.0
  environment:
    ETA_AUTH_PROVIDER: local
    ETA_DB_PROVIDER: postgres
    ETA_DB_HOST: localhost
    ETA_DB_PORT: 5432
    ETA_DB_USERNAME: ubuntu
    ETA_DB_DATABASE: circle_test
    COVERALLS_PARALLEL: true
    COVERALLS_REPO_TOKEN: 61lk9EDTJ2mWHZ7si4UtAWxtidLZ6LxXm
compile:
  override:
    - npm run eta -- generate indexes
    - npm run eta -- compile server
test:
  override:
    - npm run test:
      environment:
        MOCHA_FILE: $CIRCLE_TEST_REPORTS/junit/test-results.xml
    - npm run coveralls
    - after_success:
      - codeclimate-test-reporter < coverage/lcov.info
notify:
  webhooks:
    - url: https://coveralls.io/webhook?repo_token=61lk9EDTJ2mWHZ7si4UtAWxtidLZ6LxXm
